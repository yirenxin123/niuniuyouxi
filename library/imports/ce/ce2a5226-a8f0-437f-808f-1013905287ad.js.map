{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "LOCAL_STORAGE_FOLDER",
    "LOCAL_STORAGE_KEY_PROJECT",
    "LOCAL_STORAGE_KEY_UPDATE_STATE",
    "MODULE_PROJECT_MANIFEST_PATH",
    "window",
    "game",
    "AssetEvent",
    "NEW_VERSION",
    "NEW_VERSION_FOUND",
    "SUCCESS",
    "FAILD",
    "PROGRESS",
    "LOCAL_PROJECT_MANIFEST_LOAD_FAIL",
    "REMOTE_VERSION_MANIFEST_LOAD_FAILD",
    "REMOTE_PROJECT_MANIFEST_LOAD_FAILD",
    "NO_NETWORK",
    "AssetConfig",
    "debugVersion",
    "debugRes",
    "debugProgress",
    "testIp",
    "testCdn",
    "concurrent",
    "line",
    "AssetsDownload",
    "require",
    "AssetsManager",
    "cc",
    "Class",
    "extends",
    "EventTarget",
    "getProgress",
    "_progress",
    "check",
    "moduleName",
    "_isUpdate",
    "log",
    "format",
    "sys",
    "isNative",
    "_storagePath",
    "jsb",
    "fileUtils",
    "getWritablePath",
    "isDirectoryExist",
    "createDirectory",
    "_nocache",
    "getLocalTime",
    "_ad",
    "_moduleName",
    "_moduleManifest",
    "_moduleState",
    "_appManifest",
    "_localManifest",
    "_remoteManifest",
    "_loadLocalManifest",
    "update",
    "tempManifest",
    "localStorage",
    "getItem",
    "complete",
    "content",
    "JSON",
    "parse",
    "e",
    "error",
    "_downloadAssets",
    "bind",
    "remoteManifest",
    "_dispatchEvent",
    "config",
    "textUpdate",
    "server",
    "url",
    "http",
    "get",
    "_noCache",
    "appManifestPath",
    "loader",
    "loadRes",
    "data",
    "version",
    "key",
    "assets",
    "filePath",
    "path",
    "join",
    "isFileExist",
    "removeFile",
    "_checkVersion",
    "remoteVersion",
    "onProgress",
    "relativePath",
    "percent",
    "state",
    "setItem",
    "stringify",
    "onComplete",
    "removeItem",
    "asset",
    "onFaild",
    "onNoNetwork",
    "download",
    "recovery",
    "type",
    "args",
    "event",
    "Event",
    "EventCustom",
    "bubbles",
    "target",
    "currentTarget",
    "dispatchEvent",
    "moduleTotal",
    "moduleCurrent",
    "loadAppManifest",
    "modules",
    "versions",
    "storagePath",
    "appManifest",
    "appVersion",
    "moduleManifest",
    "manifest",
    "localManifest",
    "localVersion",
    "useSSL",
    "gateSocketIp",
    "version_json",
    "json",
    "delete",
    "module",
    "exports"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "/** \r\n * 资源管理\r\n * Author      : donggang\r\n * Create Time : 2016.11.26\r\n * \r\n * 需求：\r\n * 1、版本配置文件对比，提示有新版本\r\n * 2、版本清单文件对比，分析需要更新的资源文件\r\n * 3、批量下载更新的资源文件保存到系统本地存储目录\r\n * 4、批量删除服务器清单文件中没有的资源文件\r\n * 5、更新失败或异常中断时，记录更新状态，下次触发更新时恢复更新进度，不下载已更新的文件\r\n * 6、智能队列更新资源文件，以游戏 fps 数据做为动态计算更新速度（手机性能不够，暂时没必要做）\r\n * 7、版本回退功能，通过查询目录的顺序，把版本版本的更新文件放到查询目录中（思考）\r\n * 8、版本文件摘要验证功能（思考）\r\n * 9、配置文件的数据内存是没有删除的（思考是否需要做处理）\r\n */\r\n\r\n// 本地缓存关键字\r\nvar LOCAL_STORAGE_FOLDER           = \"game-remote-asset\";       // 版本资源目录\r\nvar LOCAL_STORAGE_KEY_PROJECT      = \"update_project\";          // 本地缓存清单数据\r\nvar LOCAL_STORAGE_KEY_UPDATE_STATE = \"update_state\";            // 本地缓存更新状态数据（每完成一个资源下载会记录完成数据队列)\r\nvar MODULE_PROJECT_MANIFEST_PATH   = \"version/{0}_project\";     // 模块清单路径\r\n\r\nwindow.game = window.game || {};\r\n\r\n// 事件\r\ngame.AssetEvent = {};\r\ngame.AssetEvent.NEW_VERSION                        = \"asset_new_version\";                           // 已是最新版本\r\ngame.AssetEvent.NEW_VERSION_FOUND                  = \"asset_new_version_found\";                     // 找到新版本\r\ngame.AssetEvent.SUCCESS                            = \"asset_success\";                               // 更新成功\r\ngame.AssetEvent.FAILD                              = \"asset_failed\";                                // 更新失败\r\ngame.AssetEvent.PROGRESS                           = \"asset_progress\";                              // 更新进度\r\ngame.AssetEvent.LOCAL_PROJECT_MANIFEST_LOAD_FAIL   = \"asset_local_project_manifest_load_fail\";      // 获取游戏中路安装包中资源清单文件失败\r\ngame.AssetEvent.REMOTE_VERSION_MANIFEST_LOAD_FAILD = \"asset_remote_version_manifest_load_faild\";    // 获取远程版本配置文件失败\r\ngame.AssetEvent.REMOTE_PROJECT_MANIFEST_LOAD_FAILD = \"asset_remote_project_manifest_load_faild\";    // 获取远程更新单清文件失败\r\ngame.AssetEvent.NO_NETWORK                         = \"asset_no_network\";                            // 断网\r\n\r\n// 配置\r\ngame.AssetConfig               = {};\r\ngame.AssetConfig.debugVersion  = false;                                                     // 无视版本号测试\r\ngame.AssetConfig.debugRes      = false;                                                     // 无视资源版本对比测试\r\ngame.AssetConfig.debugProgress = false;                                                     // 打印进度日志\r\ngame.AssetConfig.testIp        = \"172.18.254.56\";                                           // 测试服务器地址\r\ngame.AssetConfig.testCdn       = \"http://\" + game.AssetConfig.testIp + \"/update/\";          // 测试 CDN 服务器地址\r\n\r\ngame.AssetConfig.concurrent    = 1;                                   // 最大并发更新文件数量（有网络IO和文件IO并载数量在边玩游戏边下载时建议不超过2）\r\ngame.AssetConfig.line          = \"line1\";                             // 版本线路文件夹，用于更新时优先更新没有用的线路，测试成功后切换热更\r\n\r\nvar AssetsDownload = require(\"AssetsDownload\");\r\nvar AssetsManager  = cc.Class({ \r\n    extends : cc.EventTarget,\r\n\r\n    /** 更新进度 */ \r\n    getProgress : function(){\r\n        return this._progress;\r\n    }, \r\n\r\n    /**\r\n     * 对比服务器版本信息\r\n     * @param appManifestPath(string)       本地清单文件路径\r\n     */\r\n    check : function (moduleName) {\r\n        if (this._isUpdate == true) {\r\n            cc.log(\"【更新】模块{0}正在更新中\".format(moduleName));\r\n            return;\r\n        }\r\n\r\n        if (cc.sys.isNative) {\r\n            this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + LOCAL_STORAGE_FOLDER);\r\n\r\n            if (jsb.fileUtils.isDirectoryExist(this._storagePath) == false) {\r\n                jsb.fileUtils.createDirectory(this._storagePath);\r\n            }\r\n\r\n            cc.log(\"【更新】版本本地存储路径 {0}\".format(this._storagePath));\r\n        }\r\n        else {\r\n            this._storagePath = \"\";\r\n        }\r\n\r\n        this._nocache = game.getLocalTime(); \r\n        this._ad      = new AssetsDownload();\r\n\r\n        this._moduleName     = moduleName;                                                  // 模块名\r\n        this._moduleManifest = LOCAL_STORAGE_KEY_PROJECT      + \"_\" + moduleName;\r\n        this._moduleState    = LOCAL_STORAGE_KEY_UPDATE_STATE + \"_\" + moduleName;  \r\n\r\n        this._appManifest;                                                                  // 安装里的清单数据（JSON)\r\n        this._localManifest;                                                                // 本地存储里的清单数据（JSON)\r\n        this._remoteManifest;                                                               // 远程更新服务器的清单数据（JSON)\r\n\r\n        this._progress = 0;                                                                 // 更新进度\r\n        this._isUpdate = true;                                                              // 是否正在更新中\r\n\r\n        this._loadLocalManifest(MODULE_PROJECT_MANIFEST_PATH.format(moduleName)); \r\n    },\r\n\r\n    /** 开始更新版本 */\r\n    update : function () {\r\n        // 获取本地存储更新状态数据，如果有则继续上次的更新，无则下载远程服务器版本清单数据\r\n        var tempManifest = cc.sys.localStorage.getItem(this._moduleState);\r\n        if (tempManifest == null) {\r\n            var complete = function (content) {\r\n                // 解析远程资源清单数据\r\n                try {\r\n                    this._remoteManifest = JSON.parse(content);\r\n                }\r\n                catch(e) {\r\n                    cc.error(\"【更新】远程路版本清单数据解析错误\");\r\n                }\r\n\r\n                // 分析并下载资源\r\n                this._downloadAssets();\r\n            }.bind(this);\r\n\r\n            var error = function (error) {\r\n                cc.log(\"【更新】获取远程路径为 {0} 的版本清单文件失败\".format(this._remoteManifest.remoteManifest));\r\n\r\n                this._isUpdate = false;\r\n                \r\n                this._dispatchEvent(game.AssetEvent.REMOTE_PROJECT_MANIFEST_LOAD_FAILD); \r\n            }.bind(this);\r\n            \r\n            if (game.config.textUpdate) this._localManifest.server = game.AssetConfig.testCdn;\r\n\r\n            var url = this._localManifest.server + game.AssetConfig.line + \"/\" + this._localManifest.remoteManifest;\r\n            game.http.get(this._noCache(url), complete, error);\r\n        }\r\n        else {\r\n            cc.log(\"【更新】获取上次没更新完的版本清单更新状态\");\r\n\r\n            this._remoteManifest = JSON.parse(tempManifest);\r\n\r\n            // 分析并下载资源\r\n            this._downloadAssets();\r\n        }\r\n    },\r\n\r\n    /** 加载本地项目中资源清单数据 */\r\n    _loadLocalManifest: function (appManifestPath) {\r\n        // 加载本地项目中资源清单数据\r\n        cc.loader.loadRes(appManifestPath, function (error, content) {\r\n            if (error) {\r\n                cc.log(\"【更新】获取游戏中路安装包中路径为 {0} 的资源清单文件失败\".format(appManifestPath));\r\n                this._dispatchEvent(game.AssetEvent.LOCAL_PROJECT_MANIFEST_LOAD_FAIL);\r\n                return;\r\n            }\r\n\r\n            // 安装包中版本清单数据解析\r\n            try {\r\n                this._appManifest = JSON.parse(content); \r\n            }\r\n            catch(e) {\r\n                cc.error(\"【更新】安装包中的版本清单数据解析错误\");\r\n            }\r\n\r\n            // 获取本地存储中版本清单数据（上次更新成功后的远程清单数据）\r\n            var data = cc.sys.localStorage.getItem(this._moduleManifest); \r\n            if (data) {\r\n                try {\r\n                    this._localManifest = JSON.parse(data); \r\n                }\r\n                catch(e) {\r\n                    cc.error(\"【更新】本地版本清单数据解析错误\");\r\n                }\r\n                \r\n                // 安装包中的版本高于本地存储版本，则替换本地存储版本数据\r\n                if (this._localManifest.version < this._appManifest.version){\r\n                    // 删除本地存储中的当前模块的旧的资源\r\n                    for (var key in this._localManifest.assets) {\r\n                        var filePath = cc.path.join(this._storagePath, key);\r\n                        if (jsb.fileUtils.isFileExist(filePath)){\r\n                            jsb.fileUtils.removeFile(filePath);\r\n                        }\r\n                    }\r\n\r\n                    cc.log(\"【更新】安装包的版本号为{0}，本地存储版本号为{1}，替换本地存储版本数据\".format(this._appManifest.version, this._localManifest.version))\r\n                    this._localManifest = this._appManifest; \r\n                }\r\n            }\r\n            else {\r\n                cc.log(\"【更新】第一次安装，获取安装版中的版本清单数据\");\r\n                this._localManifest = this._appManifest; \r\n            }\r\n\r\n            // 检查版本号\r\n            this._checkVersion();\r\n        }.bind(this));\r\n    },\r\n\r\n    /** 检查版本号 */\r\n    _checkVersion: function () {\r\n        var complete = function (content) {\r\n            /** 远程版本数据解析 */\r\n            try {\r\n                var remoteVersion = JSON.parse(content);\r\n\r\n                // 游戏中路资源版本小于远程版本时，提示有更新\r\n                if (game.AssetConfig.debugVersion || this._localManifest.version < remoteVersion.version) {\r\n                    cc.log(\"【更新】当前版本号为 {0}，服务器版本号为 {1}, 有新版本可更新\".format(this._appManifest.version, remoteVersion.version));\r\n                    this._dispatchEvent(game.AssetEvent.NEW_VERSION_FOUND);       // 触发有新版本事件\r\n                }\r\n                else{\r\n                    cc.log(\"【更新】当前为最新版本\");\r\n                    this._isUpdate = false;\r\n                    this._dispatchEvent(game.AssetEvent.NEW_VERSION);             // 触发已是最新版本事件\r\n                }\r\n            }\r\n            catch(e) {\r\n                cc.error(\"【更新】远程路版本数据解析错误\");\r\n            }\r\n        }.bind(this);\r\n\r\n        var error = function (error) {\r\n            cc.log(\"【更新】获取远程路径为 {0} 的版本文件失败\".format(this._localManifest.remoteVersion));\r\n            this._isUpdate = false;\r\n            this._dispatchEvent(game.AssetEvent.REMOTE_VERSION_MANIFEST_LOAD_FAILD); \r\n        }.bind(this);\r\n\r\n        if (game.config.textUpdate) this._localManifest.server = game.AssetConfig.testCdn;\r\n\r\n        // 获取远程版本数据\r\n        var url = this._localManifest.server + game.AssetConfig.line + \"/\" + this._localManifest.remoteVersion;\r\n        game.http.get(this._noCache(url), complete, error);\r\n    },\r\n\r\n    /** 开始下载资源 */\r\n    _downloadAssets: function () {\r\n        // 触发热更进度事件\r\n        this._ad.onProgress = function(relativePath, percent){\r\n            this._progress = percent;\r\n\r\n            // 记录当前更新状态，更新失败时做为恢复状态使用\r\n            this._remoteManifest.assets[relativePath].state = true;\r\n            cc.sys.localStorage.setItem(this._moduleState, JSON.stringify(this._remoteManifest));\r\n\r\n            this._dispatchEvent(game.AssetEvent.PROGRESS); \r\n        }.bind(this);\r\n\r\n        // 触发热更完成事件\r\n        this._ad.onComplete = function(){\r\n            this._isUpdate = false;\r\n\r\n            // 删除更新状态数据 \r\n            cc.sys.localStorage.removeItem(this._moduleState);\r\n\r\n            // 更新本地版本清单数据，用于下次更新时做版本对比\r\n            for (var key in this._remoteManifest.assets) {\r\n                var asset = this._remoteManifest.assets[key];\r\n                if (asset.state) delete asset.state;\r\n            }\r\n            cc.sys.localStorage.setItem(this._moduleManifest, JSON.stringify(this._remoteManifest)); \r\n\r\n            // 触发热更完成事件\r\n            this._dispatchEvent(game.AssetEvent.SUCCESS); \r\n        }.bind(this);\r\n\r\n        // 触发热更失败事件\r\n        this._ad.onFaild = function(){\r\n            this._isUpdate = false;\r\n            this._dispatchEvent(game.AssetEvent.FAILD);\r\n        }.bind(this);\r\n\r\n        // 触发断网事件\r\n        this._ad.onNoNetwork = function(){\r\n            this._isUpdate = false;\r\n            this._dispatchEvent(game.AssetEvent.NO_NETWORK);\r\n        }.bind(this);\r\n\r\n        this._ad.download(this._storagePath, this._localManifest, this._remoteManifest);\r\n    },\r\n\r\n    /** 断网后恢复状态 */\r\n    recovery : function(){\r\n        this._ad.recovery();\r\n    },\r\n\r\n    /**\r\n     * 触发事件\r\n     * @param type(string)      事件类型\r\n     * @param args(object)      事件参数\r\n     */\r\n    _dispatchEvent : function(type, args){\r\n        var event           = new cc.Event.EventCustom();\r\n        event.type          = type; \r\n        event.bubbles       = false;\r\n        event.target        = this;\r\n        event.currentTarget = this;\r\n        this.dispatchEvent(event); \r\n    },\r\n\r\n    /** 规避 HTTP 缓存问题 */\r\n    _noCache: function (url) {\r\n        return url + \"?t=\" + this._nocache;\r\n    }\r\n})\r\n\r\n/** 验证是否有覆盖安装，安装包中版本高于本地资源时，删除本地资源的模块资源 */\r\nAssetsManager.check = function(remoteVersion){\r\n    var moduleTotal   = 0;\r\n    var moduleCurrent = 0;\r\n\r\n    // 加载安装包中的版本清单文件\r\n    var loadAppManifest = function(moduleName, modules, versions, remoteVersion){\r\n        var appManifestPath = MODULE_PROJECT_MANIFEST_PATH.format(moduleName);\r\n        cc.loader.loadRes(appManifestPath, function (error, content) { \r\n            if (error) {\r\n                cc.error(\"【更新】验证是否有覆盖安装时，获取游戏中路安装包中路径为 {0} 的资源清单文件失败\".format(appManifestPath));\r\n                return;\r\n            }\r\n    \r\n            var storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + LOCAL_STORAGE_FOLDER);\r\n            var appManifest = JSON.parse(content); \r\n            var appVersion  = appManifest.version;\r\n\r\n            // 获取本地版本清单信息\r\n            var moduleManifest = LOCAL_STORAGE_KEY_PROJECT + \"_\" + moduleName;\r\n            var manifest       = cc.sys.localStorage.getItem(moduleManifest); \r\n            if (manifest) {\r\n                var localManifest = JSON.parse(manifest); \r\n                var localVersion  = localManifest.version;\r\n\r\n                // 安装包中的版本高于本地存储版本，则替换本地存储版本数据\r\n                if (localVersion < appVersion){ \r\n                    // 删除本地存储中的当前模块的旧的资源\r\n                    for (var key in localManifest.assets) {\r\n                        var filePath = cc.path.join(storagePath, key);\r\n                        if (jsb.fileUtils.isFileExist(filePath)){\r\n                            jsb.fileUtils.removeFile(filePath);  \r\n                        } \r\n                    }\r\n\r\n                    versions[moduleName] = appVersion;                             // 有本地清单数据时，当前版本号为安装包版本号\r\n                    modules[moduleName]  = modules[moduleName] > appVersion;       // 有本地清单数据时，安卓包版本号小于远程版本号\r\n                }\r\n                else{\r\n                    versions[moduleName] = localVersion;                           // 有本地清单数据时，当前版本号为本地版本号\r\n                    modules[moduleName]  = modules[moduleName] > localVersion;     // 有本地清单数据时，本地清单版本号小于远程版本号\r\n                }\r\n            }\r\n            else{\r\n                versions[moduleName] = appVersion;                                 // 没有本地清单数据时，当前版本号为安装包版本号\r\n                modules[moduleName]  = modules[moduleName] > appVersion;           // 没有本地清单数据时，安卓包版本号小于远程版本号\r\n            }\r\n\r\n            moduleCurrent++;\r\n\r\n            if (moduleCurrent == moduleTotal){\r\n                if (remoteVersion) remoteVersion(modules, versions);\r\n            }\r\n        });\r\n    }\r\n\r\n    // 游戏所有模块的配置文件\r\n    var url = \"\"; \r\n\r\n    if (game.config.useSSL){\r\n        url = \"https://{0}:3001/constinfo/version?t={1}\".format(game.config.gateSocketIp, game.getLocalTime());\r\n    }\r\n    else{\r\n        url = \"http://{0}:3001/constinfo/version?t={1}\".format(game.config.gateSocketIp, game.getLocalTime());\r\n    }\r\n\r\n    if (game.config.textUpdate) url = \"http://{0}:3001/constinfo/version.json?t={1}\".format(game.AssetConfig.testIp, game.getLocalTime());\r\n\r\n    // 加载游戏模块当前最前版本号数据\r\n    game.http.get(url, function(version_json){\r\n        var json     = JSON.parse(version_json);\r\n        var modules  = json.modules;\r\n        var versions = {};\r\n        game.AssetConfig.line = json.line;\r\n\r\n        // 计算游戏共有多少个模块\r\n        for(var moduleName in modules){\r\n            moduleTotal++;\r\n        }\r\n\r\n        // 载入游戏所有安装包中的模块版本数据\r\n        for(var moduleName in modules){\r\n            loadAppManifest(moduleName, modules, versions, remoteVersion);\r\n        }\r\n    }.bind(this));\r\n}\r\n\r\n/** \r\n * 删除模块 \r\n * @param moduleName(string)    模块名\r\n */\r\nAssetsManager.delete = function(moduleName){\r\n    var storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + LOCAL_STORAGE_FOLDER);\r\n    var data        = cc.sys.localStorage.getItem(LOCAL_STORAGE_KEY_PROJECT + \"_\" + moduleName);\r\n    if (data) {\r\n        try {\r\n            var localManifest = JSON.parse(data); \r\n\r\n            for (var key in localManifest.assets) {\r\n                var filePath = cc.path.join(storagePath, key);\r\n                if (jsb.fileUtils.isFileExist(filePath)){\r\n                    jsb.fileUtils.removeFile(filePath);\r\n                }\r\n            }\r\n        }\r\n        catch(e) {\r\n            cc.error(\"【更新】删除模块时,本地版本清单数据解析错误\");\r\n        }\r\n\r\n        cc.sys.localStorage.removeItem(LOCAL_STORAGE_KEY_PROJECT      + \"_\" + moduleName);\r\n        cc.sys.localStorage.removeItem(LOCAL_STORAGE_KEY_UPDATE_STATE + \"_\" + moduleName);\r\n    }\r\n}\r\n\r\ngame.asset = module.exports = AssetsManager;\r\n"
  ]
}