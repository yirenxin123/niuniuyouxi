{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "m_EncryptMap",
    "getutf8bytecount",
    "byteval",
    "bCount",
    "i",
    "utf8tounicode",
    "code",
    "String",
    "fromCharCode",
    "bStart",
    "bFinish",
    "newCode",
    "bFlag",
    "val",
    "t",
    "unicodetoutf8",
    "bytelen",
    "bByte",
    "Math",
    "ceil",
    "bTmp",
    "utf8Code",
    "bValue",
    "utfbytes2string",
    "bytes",
    "length",
    "retString",
    "utf8code",
    "prototype",
    "toUtf8",
    "strLen",
    "allBytes",
    "allLen",
    "unicode",
    "charCodeAt",
    "result",
    "push",
    "codes",
    "bytelens",
    "item",
    "type",
    "len",
    "value",
    "htl",
    "offset",
    "obj",
    "Object",
    "bBig",
    "undefined",
    "SocketData",
    "arraybuffer",
    "writeMap",
    "m_nBufPos",
    "window",
    "PACKET_HEADER_SIZE",
    "m_nPacketSize",
    "aDataArray",
    "DataView",
    "_writeHeaderByte",
    "_readHeaderByte",
    "getUint8",
    "_writeHeaderShort",
    "_readHeaderShort",
    "getInt16",
    "_writeHeaderInt",
    "_readHeaderInt",
    "getInt32",
    "WriteByte",
    "ReadByte",
    "checkReadOut",
    "WriteShort",
    "ReadShort",
    "WriteInt",
    "ReadInt",
    "WriteInt64",
    "ReadInt64",
    "low",
    "getUint32",
    "higt",
    "longVal",
    "Long",
    "toNumber",
    "WriteString",
    "ReadString",
    "b",
    "getAllLength",
    "indexOf",
    "byteLength",
    "_getbuffer",
    "ArrayBuffer",
    "setUint8",
    "setInt16",
    "setInt32",
    "n",
    "langValue",
    "fromValue",
    "toBytesBE",
    "j",
    "setOffset",
    "_reset",
    "m_isCheckCode",
    "Begin",
    "nCommand",
    "uid",
    "cVersion",
    "_begin",
    "cmd",
    "source",
    "SOURCE_TYPE",
    "GAME_ID",
    "SetOptType",
    "End",
    "_end",
    "nBody",
    "IsWriteCheckCode",
    "GetBodyLength",
    "nLen",
    "EncryptBuffer",
    "wDataSize",
    "EnCode",
    "floor",
    "random",
    "MAX_ENCRYPT_MAP",
    "EnCodeNum",
    "CheckCode",
    "data",
    "SetEnCode",
    "WriteCheckCode",
    "buffer",
    "CrevasseBuffer",
    "GetEnCode",
    "GetCheckCode",
    "encode",
    "nValue",
    "Reset",
    "GetCmdType",
    "nCmdType",
    "module",
    "exports"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "/**\r\n * Created by shrimp on 17/2/19.\r\n */\r\n\r\nvar m_EncryptMap=\r\n    [\r\n        0x51,0xA1,0x9E,0xD7,0x1E,0x83,0x1C,0x2D,0xE9,0x77,0x3D,0x13,0x93,0x10,0x45,0xFF,\r\n        0x6D,0xC9,0x20,0x2F,0x1B,0x82,0x1A,0x7D,0xF5,0xCF,0x52,0xA8,0xD2,0xA4,0xB4,0x0B,\r\n        0x31,0x97,0x57,0x19,0x34,0xDF,0x5B,0x41,0x58,0x49,0xAA,0x5F,0x0A,0xEF,0x88,0x01,\r\n        0xDC,0x95,0xD4,0xAF,0x7B,0xE3,0x11,0x8E,0x9D,0x16,0x61,0x8C,0x84,0x3C,0x1F,0x5A\r\n    ];\r\n\r\nfunction getutf8bytecount(byteval)\r\n{\r\n    var bCount = 0;\r\n    for (var i = 7; i >= 0; --i)\r\n    {\r\n        if (byteval & (1 << i)) {\r\n            bCount++;\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n    return bCount;\r\n}\r\n\r\nfunction utf8tounicode(code)\r\n{\r\n    if (code <= 0x7f) {\r\n        return String.fromCharCode(code)\r\n    }\r\n    var bStart = false;\r\n    var bCount = 0;\r\n    var bFinish = false;\r\n    var newCode = 0;\r\n    var bFlag = code & 0xff;\r\n    bCount = getutf8bytecount(bFlag);\r\n    var newCode = 0;\r\n    for (var i = 0; i < bCount; ++i) {\r\n        var val = code & (0xff << (i * 8))\r\n\r\n        val = val >>> (i * 8)\r\n        if (i == 0) {\r\n            for (var t = 1; t <= bCount; ++t) {\r\n                val = val & (~(1 << (8 - t)));\r\n            }\r\n        } else {\r\n            val = val & 0x3f;\r\n        }\r\n        newCode += val << (6 * (bCount - i - 1));\r\n    }\r\n    return String.fromCharCode(newCode)\r\n}\r\n\r\nfunction unicodetoutf8(code)\r\n{\r\n    if (code <= 0x7f) { // 不需要转换\r\n        return {code:code, bytelen:1};;\r\n    }\r\n\r\n    var bCount = 0; // 二进制位数量\r\n    for (var i = 0; i < 32; ++i) {\r\n        if (code & (1 << i)) {\r\n            bCount = i + 1;\r\n        }\r\n    }\r\n    var bByte = 0;\r\n    // utf8编码占用的字节数\r\n    bByte = Math.ceil(bCount / 6);\r\n\r\n    // 计算是否要进位\r\n    var bTmp = bCount % 6;\r\n    bTmp = (bTmp == 0) ? 6 : bTmp;\r\n\r\n    if (bTmp > (7 - bByte)) {\r\n        bByte++;\r\n    }\r\n    // 填充编码\r\n    var utf8Code = 0;\r\n    for (var i = 0; i < bByte - 1; ++i)\r\n    {\r\n        var bValue = (code >>> (i * 6)) & 0x3f; // 最低位放到最高位\r\n        bValue = (1 << 7) + bValue;\r\n\r\n        utf8Code += bValue << ((bByte - i - 1) * 8);\r\n    }\r\n\r\n    // 填充最后剩余的编码\r\n    var bValue = code >>> ((bByte - 1) * 6);\r\n\r\n    // 填充标识符\r\n    var bFlag = 0;\r\n    for (var i = 0; i < bByte; ++i) {\r\n        bFlag += 1 << (7 - i);\r\n    }\r\n\r\n    utf8Code += bFlag + bValue;\r\n\r\n    return {code:utf8Code, bytelen:bByte};\r\n}\r\n\r\nfunction utfbytes2string(bytes)\r\n{\r\n    if (bytes.length == 0) {\r\n        return \"\";\r\n    }\r\n    var retString = \"\";\r\n    for (var i = 0; i < bytes.length; )\r\n    {\r\n        if (bytes[i] <= 0x7f) {\r\n            retString += utf8tounicode(bytes[i]);\r\n            i++;\r\n            continue;\r\n        }\r\n        var bCount = getutf8bytecount(bytes[i]);\r\n        var utf8code = 0;\r\n        for (var t = 0; t < bCount; ++t) {\r\n            utf8code += bytes[i + t] << (t * 8)\r\n        }\r\n        retString += utf8tounicode(utf8code);\r\n        i += bCount;\r\n    }\r\n    return retString;\r\n}\r\n\r\nString.prototype.toUtf8 = function() {\r\n    var strLen = this.length;\r\n    var allBytes = [];\r\n    var allLen = 0;\r\n    for (var i = 0; i < strLen; ++i) {\r\n        var unicode = this.charCodeAt(i);\r\n        var result = unicodetoutf8(unicode);\r\n        allLen += result.bytelen;\r\n        allBytes.push(result);\r\n    }\r\n    return {codes: allBytes, bytelens: allLen};\r\n};\r\n\r\n\r\n//htl，大小端  offset 指定位置\r\nfunction item(type, len, value,htl,offset)\r\n{\r\n    var obj = new Object();\r\n    obj.type = type;\r\n    obj.len = len;\r\n    obj.value = value;\r\n    var bBig =  htl === undefined? true:htl;\r\n    obj.htl = bBig;\r\n    obj.offset = offset;\r\n    return obj;\r\n}\r\n\r\n\r\nfunction SocketData(arraybuffer)\r\n{\r\n    this.offset = 0;\r\n    this.writeMap = [];\r\n\r\n    this.m_nBufPos = window.PACKET_HEADER_SIZE;\r\n    this.m_nPacketSize = window.PACKET_HEADER_SIZE;\r\n\r\n    this.aDataArray = null ;\r\n    if (arraybuffer) {\r\n        this.aDataArray = new DataView(arraybuffer);\r\n    }\r\n}\r\n\r\n//---------------------包头特殊\r\n\r\nSocketData.prototype._writeHeaderByte = function(value,offset) {\r\n    this.writeMap.push(item(\"headbyte\", 1, value,true,offset));\r\n}\r\n\r\nSocketData.prototype._readHeaderByte = function(offset) {\r\n    var value =  this.aDataArray.getUint8(offset,true)\r\n    return value;\r\n}\r\n\r\nSocketData.prototype._writeHeaderShort = function(value,offset) {\r\n    this.writeMap.push(item(\"headshort\", 2, value,false,offset));\r\n}\r\n\r\nSocketData.prototype._readHeaderShort = function(offset) {\r\n    var value =  this.aDataArray.getInt16(offset,false)\r\n    return value;\r\n}\r\n\r\nSocketData.prototype._writeHeaderInt = function(value,offset) {\r\n    this.writeMap.push(item(\"headint\", 4, value,false,offset));\r\n}\r\n\r\nSocketData.prototype._readHeaderInt = function(offset) {\r\n    var value =  this.aDataArray.getInt32(offset,false)\r\n    return value;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n//-------------------------byte---------------------\r\n\r\nSocketData.prototype.WriteByte = function(value,bBig) {\r\n    this.writeMap.push(item(\"int8\", 1, value,bBig));\r\n}\r\nSocketData.prototype.ReadByte = function(bBig) {\r\n    if(this.checkReadOut(1)){\r\n        return 0;\r\n    }\r\n    var htl =  bBig === undefined? true:bBig;\r\n    var value = this.aDataArray.getUint8(this.offset, htl)\r\n    this.offset += 1\r\n    return value;\r\n}\r\n\r\n//-----------------------short---------------------\r\n\r\nSocketData.prototype.WriteShort = function(value,bBig) {\r\n    var htl =  bBig === undefined? false:bBig;\r\n    this.writeMap.push(item(\"int16\", 2, value,htl));\r\n}\r\nSocketData.prototype.ReadShort = function(bBig) {\r\n    if(this.checkReadOut(2)){\r\n        return 0;\r\n    }\r\n    var htl =  bBig === undefined? false:htl;\r\n    var value = this.aDataArray.getInt16(this.offset, htl)\r\n    this.offset += 2\r\n    return value;\r\n}\r\n\r\n//-----------------------int---------------------\r\n\r\nSocketData.prototype.WriteInt = function(value,bBig) {\r\n    var htl =  bBig === undefined? false:bBig;\r\n    this.writeMap.push(item(\"int32\", 4, value,htl));\r\n}\r\nSocketData.prototype.ReadInt = function(bBig) {\r\n    if(this.checkReadOut(4)){\r\n        return 0;\r\n    }\r\n    var htl =  bBig === undefined? false:bBig;\r\n    var value = this.aDataArray.getInt32(this.offset, htl)\r\n    this.offset += 4\r\n    return value;\r\n}\r\n\r\n\r\n//-----------------------int64---------------------\r\nSocketData.prototype.WriteInt64 = function(value,bBig) {\r\n    var htl =  bBig === undefined? false:bBig;\r\n    this.writeMap.push(item(\"int64\", 8, value,htl));\r\n}\r\n\r\nSocketData.prototype.ReadInt64 = function(bBig) {\r\n    if(this.checkReadOut(8)){\r\n        return 0;\r\n    }\r\n\r\n    var htl =  bBig === undefined ? false : bBig;\r\n    var low = this.aDataArray.getUint32(this.offset, htl)\r\n    this.offset += 4\r\n    var higt = this.aDataArray.getUint32(this.offset, htl)\r\n    this.offset += 4\r\n    var longVal = new Long(higt,low, false);\r\n    return longVal.toNumber();\r\n}\r\n\r\n//-----------------------string---------------------\r\n\r\nSocketData.prototype.WriteString = function(value,bBig) {\r\n    var htl =  bBig === undefined? false:bBig;\r\n    var result = value.toUtf8();\r\n    this.writeMap.push(item(\"string\", result.bytelens + 4 + 1, result,htl)); // +4 是因为字符串前面要写入一个长度\r\n}\r\nSocketData.prototype.ReadString = function(bBig) {\r\n\r\n    if(this.checkReadOut(4)){\r\n        return \"\";\r\n    }\r\n\r\n    var htl =  bBig === true? false:bBig;\r\n    var len = this.aDataArray.getInt32(this.offset);\r\n    this.offset += 4;\r\n    var bytes = [];\r\n    for (var i = 0; i < len; ++i)\r\n    {\r\n        var b = this.ReadByte();\r\n        // var b = this.aDataArray.getUint8(this.offset);\r\n        bytes.push(b);\r\n        // this.offset += 1;\r\n    }\r\n    return utfbytes2string(bytes);\r\n}\r\n\r\n\r\nSocketData.prototype.getAllLength = function() {\r\n    var allLen =window.PACKET_HEADER_SIZE;\r\n    for (var i = 0; i < this.writeMap.length; ++i)\r\n    {\r\n        if(this.writeMap[i].type.indexOf(\"head\") == -1){\r\n            allLen += this.writeMap[i].len\r\n        }\r\n\r\n    }\r\n    return allLen;\r\n}\r\n\r\n\r\nSocketData.prototype.checkReadOut = function (length) {\r\n    if((this.offset +length) >  this.aDataArray.byteLength ){\r\n        return true;\r\n    }\r\n    return false ;\r\n}\r\n\r\n\r\nSocketData.prototype._getbuffer = function() {\r\n\r\n    var allLen = this.getAllLength();\r\n\r\n    var arraybuffer = new ArrayBuffer(allLen);\r\n\r\n    this.aDataArray = new DataView(arraybuffer);\r\n\r\n    var offset = window.PACKET_HEADER_SIZE;;\r\n\r\n    for (var i = 0; i < this.writeMap.length; ++i)\r\n    {\r\n        var value = this.writeMap[i].value ;\r\n        var htl = this.writeMap[i].htl\r\n        switch (this.writeMap[i].type)\r\n        {\r\n\r\n            case \"headbyte\":\r\n                this.aDataArray.setUint8(this.writeMap[i].offset, value,htl);\r\n                break ;\r\n\r\n            case \"headshort\":\r\n                this.aDataArray.setInt16(this.writeMap[i].offset, value,htl);\r\n                break ;\r\n\r\n            case \"headint\":\r\n                this.aDataArray.setInt32(this.writeMap[i].offset, value,htl);\r\n                break ;\r\n\r\n            case \"int8\":\r\n                this.aDataArray.setUint8(offset, value,htl);\r\n                offset += 1;\r\n                break;\r\n\r\n            case \"int16\":\r\n                this.aDataArray.setInt16(offset, value,htl);\r\n                offset += 2;\r\n                break;\r\n\r\n            case \"int32\":\r\n                this.aDataArray.setInt32(offset, value,htl);\r\n                offset += 4;\r\n                break;\r\n\r\n            case \"string\":\r\n                // 写入长度\r\n                this.aDataArray.setInt32(offset, this.writeMap[i].value.bytelens+1,htl);\r\n                offset += 4;\r\n\r\n                // 写入字节数据\r\n                var codes = this.writeMap[i].value.codes;for (var n = 0; n < codes.length; ++n)\r\n            {\r\n                var code = codes[n].code;\r\n                var len = codes[n].bytelen;\r\n                for (var t = 0; t < len; ++t)\r\n                {\r\n                    var b = (code >> (t * 8)) & 0xff;\r\n                    this.aDataArray.setUint8(offset, b);\r\n                    offset += 1;\r\n                }\r\n            }\r\n\r\n\r\n                this.aDataArray.setUint8(offset, 0);\r\n                offset += 1;\r\n                break;\r\n\r\n            case \"int64\":\r\n                var langValue = Long.fromValue(this.writeMap[i].value,htl);\r\n                var bytes = langValue.toBytesBE();\r\n\r\n                for (var j = 0; j < bytes.length; j++)\r\n                {\r\n                    this.aDataArray.setUint8(offset + j, bytes[j]);\r\n                }\r\n                offset += 8;\r\n\r\n                break;\r\n\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    this.m_nPacketSize = offset;\r\n    return arraybuffer;\r\n}\r\n\r\nSocketData.prototype.setOffset = function(offset){\r\n    this.offset = offset ;\r\n}\r\n\r\nSocketData.prototype. _reset = function(){\r\n    this.offset = 0;\r\n    this.writeMap = [];\r\n    this.m_nBufPos = window.PACKET_HEADER_SIZE;\r\n    this.m_nPacketSize = window.PACKET_HEADER_SIZE;\r\n    this.m_isCheckCode = false;\r\n}\r\n\r\n\r\nSocketData.prototype.Begin =function( nCommand,  uid ,  cVersion ){\r\n    this._begin(nCommand, uid, cVersion);\r\n    this.m_isCheckCode = false;\r\n}\r\n\r\nSocketData.prototype._begin = function ( nCommand,  uid,  cVersion){\r\n    this._reset();\r\n    var cmd = nCommand;\r\n    var uid = uid;\r\n    var source = window.SOURCE_TYPE;\r\n\r\n    this._writeHeaderByte(cVersion,4); // 版本号\r\n    this._writeHeaderShort(cmd,5); // 命令码\r\n    this._writeHeaderByte(source,11); // 消息来源\r\n\r\n    var type = window.GAME_ID;\r\n    this. _writeHeaderByte(type,12);\r\n    this. _writeHeaderInt(uid,13);\r\n};\r\n\r\nSocketData.prototype.SetOptType = function(value) {\r\n    this._writeHeaderByte(value, 12);\r\n};\r\n\r\n\r\nSocketData.prototype.End = function(){\r\n    this.m_isCheckCode = false;\r\n    this._end();\r\n}\r\n\r\nSocketData.prototype._end = function(){\r\n    var nBody = this.getAllLength() - 4 ;\t//数据包长度包括命令头和body,4个字节是数据包长度\r\n    var len = nBody;\r\n    this._writeHeaderInt(len,0);\t// 包正文长度\r\n    var code = 0;\r\n    this._writeHeaderByte(code, 17);\t//效验码\r\n};\r\n\r\nSocketData.prototype.IsWriteCheckCode = function(){\r\n    return this.m_isCheckCode;\r\n};\r\n\r\n\r\n\r\n/*整个包的长度*/\r\nSocketData.prototype. GetBodyLength = function ()\r\n{\r\n    var nLen;\r\n    nLen =  this._readHeaderInt( 0);\r\n    return nLen;\r\n}\r\n\r\n\r\n\r\n\r\nSocketData.prototype.EncryptBuffer = function(){\r\n    if(this.IsWriteCheckCode())\r\n        return ;\r\n\r\n    this._getbuffer();\r\n\r\n    var wDataSize = this.GetBodyLength() - window.PACKET_HEADER_SIZE + 4;\r\n    var EnCode = Math.floor(Math.random() * (window.MAX_ENCRYPT_MAP))\r\n    EnCode = 0 ;\r\n    var EnCodeNum = m_EncryptMap[EnCode];\r\n    var CheckCode=0;\r\n\r\n    for ( var i = 0 ; i < wDataSize ; i++ )\r\n    {\r\n        var data = this.aDataArray.getUint8(window.PACKET_HEADER_SIZE +i,true);\r\n        CheckCode += data;\r\n        CheckCode &= 0xff;\r\n        data ^= EnCodeNum;\r\n        data &= 0xff;\r\n        this.aDataArray.setUint8(window.PACKET_HEADER_SIZE +i, data,true);\r\n    }\r\n\r\n    this.SetEnCode(EnCode);\r\n    this.WriteCheckCode((~CheckCode+1) & 0xff);\r\n\r\n    return  this.aDataArray.buffer;\r\n}\r\n\r\n\r\nSocketData.prototype.CrevasseBuffer = function(){\r\n\r\n    var wDataSize = this.GetBodyLength()- window.PACKET_HEADER_SIZE +4;\r\n    var EnCode = this.GetEnCode();\r\n    if(EnCode >= window.MAX_ENCRYPT_MAP)\r\n    {\r\n        return -1 ;\r\n    }\r\n\r\n    var EnCodeNum = m_EncryptMap[EnCode];\r\n    var CheckCode = this.GetCheckCode();\r\n\r\n    for(var i = 0 ; i < wDataSize; i++ ){\r\n        var data = this.aDataArray.getUint8(window.PACKET_HEADER_SIZE +i,true);\r\n        data &= 0xff;\r\n        data ^= EnCodeNum;\r\n\r\n        CheckCode &= 0xff;\r\n        CheckCode += data;\r\n        this.aDataArray.setUint8(window.PACKET_HEADER_SIZE +i, data,true);\r\n\r\n    }\r\n    if((CheckCode & 0xff)!=0)\r\n    {\r\n        return -1;\r\n    }\r\n\r\n    return wDataSize;\r\n\r\n}\r\n\r\n\r\n\r\nSocketData. prototype.SetEnCode = function(i)\r\n{\r\n    // this._writeHeaderByte(i, 8);\r\n    this.aDataArray.setUint8(8, i,true);\r\n}\r\n\r\nSocketData.prototype.GetEnCode = function(){\r\n    var encode = this._readHeaderByte(8);\r\n    return encode ;\r\n}\r\n\r\n\r\nSocketData. prototype.WriteCheckCode = function ( nValue)\r\n{\r\n    // this._writeHeaderByte(nValue,17);\r\n    this.aDataArray.setUint8(17, nValue,true);\r\n    this.m_isCheckCode = true;\r\n}\r\n\r\n\r\nSocketData. prototype. GetCheckCode = function()\r\n{\r\n    var code = this._readHeaderByte(17);\r\n    return code;\r\n}\r\n\r\n\r\nSocketData.prototype.Reset = function(){\r\n    this._reset();\r\n}\r\n\r\nSocketData.prototype.GetCmdType = function()\r\n{\r\n    var nCmdType = this._readHeaderShort(5);\r\n    return nCmdType;\r\n}\r\n\r\n\r\nmodule.exports = SocketData;"
  ]
}