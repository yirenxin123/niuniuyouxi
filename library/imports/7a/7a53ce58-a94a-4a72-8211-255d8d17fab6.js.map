{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [
    "GameCallOC",
    "require",
    "LoadingView",
    "HttpManager",
    "Platform",
    "GamePlayer",
    "SocketManager",
    "wxApi",
    "prototype",
    "sendWeChatLogin",
    "cc",
    "log",
    "sys",
    "platform",
    "ANDROID",
    "SocialUtils",
    "loginWeixin",
    "isNative",
    "getInstance",
    "checkIsAble",
    "ret",
    "jsb",
    "reflection",
    "callStaticMethod",
    "sendTextContent",
    "type",
    "string",
    "url",
    "sendImageContent",
    "sendLinkContent",
    "sendAppContent",
    "clearWeChatLogin",
    "weChatPay",
    "goodid",
    "openid",
    "WeChatApi",
    "weChatPayForAndroid",
    "uid",
    "xhr",
    "loader",
    "getXMLHttpRequest",
    "open",
    "onreadystatechange",
    "readyState",
    "status",
    "data",
    "JSON",
    "parse",
    "responseText",
    "order_num",
    "appid",
    "partnerId",
    "prepayId",
    "nonceStr",
    "timeStamp",
    "sign",
    "payWeixin",
    "error",
    "console",
    "bind",
    "ontimeout",
    "e",
    "onerror",
    "send",
    "wxLoginSuccess",
    "unionid",
    "name",
    "headimgurl",
    "sex",
    "headurl",
    "Number",
    "startSocket",
    "wxGetCode",
    "success",
    "code",
    "access_token",
    "info_url",
    "xhr2",
    "data2",
    "undefined",
    "onWXPay",
    "onWXPayResponse",
    "instance",
    "module",
    "exports"
  ],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "/**\r\n * Created by lixiaofei on 17/3/12.\r\n */\r\nvar GameCallOC = require('GameCallOC');\r\nvar LoadingView = require('LoadingView');\r\nvar HttpManager = require('HttpManager');\r\nvar Platform = require('Platform');\r\nvar GamePlayer = require('GamePlayer');\r\nvar SocketManager = require('SocketManager');\r\n\r\nfunction  wxApi()\r\n{\r\n\r\n}\r\n\r\nwxApi.prototype.sendWeChatLogin = function () {\r\n\tcc.log(\"wxApi.prototype.sendTextContent \");\r\n\tif(cc.sys.platform == cc.sys.ANDROID){ \r\n\t\tSocialUtils.loginWeixin();\r\n\t}else{\r\n\t\tif(cc.sys.isNative && GameCallOC.getInstance().checkIsAble())\r\n\t\t{\r\n\t\t\tvar ret = jsb.reflection.callStaticMethod(\r\n\t\t\t\t\"LocalInfo\",\r\n\t\t\t\t\"sendWeChatLogin\"\r\n\t\t\t);\r\n\t\t\tcc.log(\"ret:%s\",ret);\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nwxApi.prototype.sendTextContent = function (type,string,url) {\r\n    cc.log(\"wxApi.prototype.sendTextContent \");\r\n    if(cc.sys.isNative && GameCallOC.getInstance().checkIsAble())\r\n    {\r\n        var ret = jsb.reflection.callStaticMethod(\r\n            \"LocalInfo\",\r\n            \"sendTextContent:desc:url:\",\r\n            type,\r\n            string,\r\n            url\r\n        );\r\n        cc.log(\"ret:%s\",ret);\r\n        return ret;\r\n    }\r\n}\r\n\r\nwxApi.prototype.sendImageContent = function (type,string,url) {\r\n    cc.log(\"wxApi.prototype.sendImageContent \");\r\n    if(cc.sys.isNative && GameCallOC.getInstance().checkIsAble())\r\n    {\r\n        var ret = jsb.reflection.callStaticMethod(\r\n            \"LocalInfo\",\r\n            \"sendImageContent:desc:url:\",\r\n            type,\r\n            string,\r\n            url\r\n        );\r\n        cc.log(\"ret:%s\",ret);\r\n        return ret;\r\n    }\r\n}\r\n\r\nwxApi.prototype.sendLinkContent = function (type,string,url) {\r\n    cc.log(\"wxApi.prototype.sendLinkContent \" + type + \",\" + string + \",\" + url);\r\n    if(cc.sys.isNative && GameCallOC.getInstance().checkIsAble())\r\n    {\r\n        var ret = jsb.reflection.callStaticMethod(\r\n            \"LocalInfo\",\r\n            \"sendLinkContent:desc:url:\",\r\n            type,\r\n            string,\r\n            url\r\n        );\r\n        cc.log(\"ret:%s\",ret);\r\n        return ret;\r\n    }\r\n}\r\n\r\nwxApi.prototype.sendAppContent = function (type,string,url) {\r\n    cc.log(\"wxApi.prototype.sendAppContent \" + type + \",\" + string + \",\" + url);\r\n    if(cc.sys.isNative && GameCallOC.getInstance().checkIsAble())\r\n    {\r\n        var ret = jsb.reflection.callStaticMethod(\r\n            \"LocalInfo\",\r\n            \"sendAppContent:desc:url:\",\r\n            type,\r\n            string,\r\n            url\r\n        );\r\n        cc.log(\"ret:%s\",ret);\r\n        return ret;\r\n    }\r\n}\r\n\r\nwxApi.prototype.clearWeChatLogin = function () {\r\n    cc.log(\"wxApi.prototype.clearWeChatLogin \");\r\n    if(cc.sys.isNative && GameCallOC.getInstance().checkIsAble())\r\n    {\r\n        var ret = jsb.reflection.callStaticMethod(\r\n            \"LocalInfo\",\r\n            \"clearWeChatLogin\"\r\n        );\r\n        cc.log(\"ret:%s\",ret);\r\n        return ret;\r\n    }\r\n}\r\n\r\nwxApi.prototype.weChatPay = function (goodid,openid) {\r\n    cc.log(\"wxApi.prototype.weChatPay, goodid=\" + goodid + \", openid=\" + openid);\r\n\tif(cc.sys.platform == cc.sys.ANDROID){\r\n\t\tWeChatApi.getInstance().weChatPayForAndroid(goodid,openid);\r\n\t}else{\r\n\t\tif(cc.sys.isNative && GameCallOC.getInstance().checkIsAble())\r\n\t\t{\r\n\t\t\tvar ret = jsb.reflection.callStaticMethod(\r\n\t\t\t\t\"LocalInfo\",\r\n\t\t\t\t\"weChatPay:openid:\",\r\n\t\t\t\tgoodid,\r\n\t\t\t\topenid\r\n\t\t\t);\r\n\t\t\tcc.log(\"ret:%s\",ret);\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nwxApi.prototype.weChatPayForAndroid = function (goodid, uid) {\r\n\tcc.log(\"weChatPayForAndroid, gooid=\" + goodid + ', uid=' + uid);\r\n\tvar url = \"http://manage.aqddp.cn/wxpay/example/pay.php?good_id=\" + goodid + \"&openid=\" + uid;\r\n\tvar xhr = cc.loader.getXMLHttpRequest();\r\n\txhr.open(\"GET\", url, true);\r\n\txhr.onreadystatechange = function () {\r\n\t\tif (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status <= 207)) {\r\n\t\t\tvar data = JSON.parse(xhr.responseText);\r\n\t\t\tif(data[\"code\"] == 0){\r\n\t\t\t\tvar order_num = data['order']['order_num'];\r\n\t\t\t\tvar appid = data['order']['appid'];\r\n\t\t\t\tvar partnerId = data['order']['orderinfo']['partnerId'];\r\n\t\t\t\tvar prepayId = data['order']['orderinfo']['prepayId'];\r\n\t\t\t\tvar nonceStr = data['order']['orderinfo']['nonceStr'];\r\n\t\t\t\tvar timeStamp = data['order']['orderinfo']['timeStamp'];\r\n\t\t\t\tvar sign = data['order']['orderinfo']['sign'];\r\n\t\t\t\t//var packageName = data['order']['orderinfo']['package'];\r\n\r\n\t\t\t\tcc.log(\"appid=\" + appid);\r\n\t\t\t\tcc.log(\"partnerId=\" + partnerId);\r\n\t\t\t\tcc.log(\"prepayId=\" + prepayId);\r\n\t\t\t\tcc.log(\"nonceStr=\" + nonceStr);\r\n\t\t\t\tcc.log(\"timeStamp=\" + timeStamp);\r\n\t\t\t\tcc.log(\"sign=\" + sign);\r\n\r\n\t\t\t\tSocialUtils.payWeixin(partnerId, prepayId, nonceStr, timeStamp, sign);\r\n\t\t\t}else{\r\n\t\t\t\tcc.error(\"error code=\" + data[\"code\"]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.log(\"error readyState=\" + xhr.readyState);\r\n\t\t}\r\n\t}.bind(this);\r\n\txhr.ontimeout = function (e) {\r\n\t\tconsole.log(\"timeout\");\r\n\t};\r\n\txhr.onerror = function () {\r\n\t\tconsole.log(\"error\");\r\n\t};\r\n\txhr.send();\r\n}\r\n\r\nwxApi.prototype.wxLoginSuccess = function (openid,unionid, name, headimgurl,sex) {\r\n    GamePlayer.getInstance().unionid  = unionid;\r\n    GamePlayer.getInstance().openid  = openid;\r\n    GamePlayer.getInstance().name     = name;\r\n    GamePlayer.getInstance().headurl  = headimgurl + \".png\";\r\n    GamePlayer.getInstance().sex      = Number(sex);\r\n    //GameCallOC.getInstance().SetAppInfo(unionid);\r\n    SocketManager.getInstance().startSocket();\r\n}\r\n\r\nwxApi.prototype.wxGetCode = function (success, code) {\r\n\tcc.log(\"onGetCode, success=\" + success + \", code=\" + code);\r\n\tvar url = \"https://api.weixin.qq.com/sns/oauth2/access_token?appid=wxd0d94b9ff6c2894d&secret=6a3b706a62833ae8c46158c01e2ee0db&code=\"+code+\"&grant_type=authorization_code\";\r\n\tvar xhr = cc.loader.getXMLHttpRequest();\r\n\txhr.open(\"GET\", url, true);\r\n\txhr.onreadystatechange = function () {\r\n\t\tif (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status <= 207)) {\r\n\t\t\tconsole.log(\"xhr.responseText=\" + xhr.responseText);\r\n\r\n\t\t\tvar data = JSON.parse(xhr.responseText);\r\n\r\n\t\t\tvar access_token = data['access_token'];\r\n\t\t\tvar openid = data['openid'];\r\n\t\t\tvar unionid = data['unionid'];\r\n\r\n\t\t\tcc.log(\"access_token=\" + access_token);\r\n\t\t\tcc.log(\"openid=\" + openid);\r\n\t\t\tcc.log(\"unionid=\" + unionid);\r\n\r\n\t\t\tvar info_url = \"https://api.weixin.qq.com/sns/userinfo?access_token=\" + access_token + \"&openid=\" + openid;\r\n\t\t\tvar xhr2 = cc.loader.getXMLHttpRequest();\r\n\t\t\txhr2.open(\"GET\", info_url, true);\r\n\t\t\txhr2.onreadystatechange = function () {\r\n\t\t\t\tif (xhr2.readyState == 4 && (xhr2.status >= 200 && xhr2.status <= 207)) {\r\n\t\t\t\t\tcc.log(\"xhr2.responseText=\" + xhr2.responseText);\r\n\t\t\t\t\tvar data2 = JSON.parse(xhr2.responseText);\r\n\t\t\t\t\t//todo. 做提示\r\n\t\t\t\t\tif(data2[\"nickname\"] == undefined || data2['headimgurl'] == undefined){\r\n\t\t\t\t\t\tcc.error(\"error\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tWeChatApi.getInstance().wxLoginSuccess(openid,unionid, data2['nickname'], data2['headimgurl'], data2['sex']);\r\n\t\t\t\t}else{\r\n\t\t\t\t}\r\n\t\t\t}.bind(this);\r\n\t\t\txhr2.ontimeout = function (e) {\r\n\t\t\t\tconsole.log(\"timeout\");\r\n\t\t\t};\r\n\t\t\txhr2.onerror = function () {\r\n\t\t\t\tconsole.log(\"error\");\r\n\t\t\t};\r\n\t\t\txhr2.send();\r\n\r\n\t\t} else {\r\n\t\t\tconsole.log(\"error readyState=\" + xhr.readyState);\r\n\t\t}\r\n\t}.bind(this);\r\n\txhr.ontimeout = function (e) {\r\n\t\tconsole.log(\"timeout\");\r\n\t};\r\n\txhr.onerror = function () {\r\n\t\tconsole.log(\"error\");\r\n\t};\r\n\txhr.send();\r\n\r\n}\r\n\r\n//开始进行微信支付\r\nwxApi.prototype.onWXPay = function(){\r\n\tcc.log(\"onWXPay\");\r\n\r\n}\r\n\r\n//微信支付回调\r\nwxApi.prototype.onWXPayResponse = function (code) {\r\n\tcc.log(\"onWXPayResponse, code=\" + code);\r\n\r\n}\r\n\r\nvar WeChatApi = (function(){\r\n    var instance ;\r\n\r\n    function getInstance(){\r\n        if( instance === undefined ){\r\n            instance = new wxApi();\r\n        }\r\n        return instance;\r\n    };\r\n\r\n    return {\r\n        getInstance : getInstance,\r\n    }\r\n})();\r\n\r\nmodule.exports = WeChatApi;"
  ]
}